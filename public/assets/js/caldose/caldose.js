
var CalculateurDose=new Class({'container':null,'form':null,'containersResultat':null,'champs':null,'resultats':null,'formules':null,'options':{'id':null},'initialize':function(options){this.setOptions(options);if(this.options.id!=null){this.container=$('calculateur-'+this.options.id);}
this.form=this.container.getElement('form');this.containersResultat=this.container.getElements('.resultat');this.champs=JSON.decode(this.container.getElement('input.json-champs').value);this.resultats=JSON.decode(this.container.getElement('input.json-resultats').value);this.formules=JSON.decode(this.container.getElement('input.json-formules').value);this.form.addEvent('submit',function(event){new Event(event).stop();this.process();}.bind(this));},'getContainer':function(){return this.container;},'process':function(){this.containersResultat.each(function(e){e.empty();});var elementsResultat=new Array();this.formules.each(function(f){var formule=f.formule;for(var i=1;i<=this.champs.length;++i){var fieldValue=this.form.getElement('.champ-calcul-'+i).value.replace(',','.');formule=formule.replace('$'+i,fieldValue);}
formule=formule.replace(/[^\w\s.()+*\/\-?:=&|%ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõöøùúûýýþÿŔŕ]/g,'');formule=formule.replace(/([()+*\/\-])/g,' $1 ');var tabFormule=formule.split(/\s+/);formule='';var quoteOpen=false;tabFormule.each(function(e){if(isNaN(e)&&e.test(/^[\wÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõöøùúûýýþÿŔŕ$]+/)){if(quoteOpen){formule+=' ';}else{formule+='\'';quoteOpen=true;}
formule+=e;}else{if(quoteOpen){formule+='\'';quoteOpen=false;}
formule+=e;}});if(quoteOpen){formule+='\'';quoteOpen=false;}
formule+=';';try{ret=eval(formule);}catch(err){ret='Une erreur s\'est produite durant le calcul !';}
elementsResultat[elementsResultat.length]=ret;}.bind(this));this.resultats.each(function(r,i){var format=r.format;for(var j=0;j<elementsResultat.length;++j){format=format.replace('@'+(j+1),elementsResultat[j]);}
format=format.replace(/[<>&]/g,'');this.containersResultat[i].appendText(format);}.bind(this));}});CalculateurDose.implement(new Options());window.addEvent('domready',function(){$$('.calculateur').addClass('hidden');if(window.location.hash.substring(1)!=""&&$(window.location.hash.substring(1))!=null){$(window.location.hash.substring(1)).removeClass('hidden');window.location.href='#'+window.location.hash.substring(1);}
var liensCalculateurs=$$('.button-action button');liensCalculateurs.each(function(el){var idCalculateur=el.get('rel');var calculateur=new CalculateurDose({'id':idCalculateur});el.addEvent('click',function(event){$$('.calculateur').addClass('hidden');calculateur.getContainer().removeClass('hidden');window.location.href='#calculateur-'+el.get('rel');});});$$('input.calcul-radio[type=radio]').addEvent('click',function(){this.getParent().getElement('input[type=hidden]').value=this.value;});});