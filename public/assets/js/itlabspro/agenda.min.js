(function() {
  var calendar, fullcalendar_eventClick, fullcalendar_eventDrop, fullcalendar_eventResize, fullcalendar_events, fullcalendar_select, resetAddDossierFormErrors, resetAddEventFormErrors, resetAddPatientFormErrors;

  fullcalendar_events = function(start, end, timezone, callback) {
    return $.ajax({
      url: 'api/events',
      dataType: 'json',
      type: 'post',
      data: {
        start: start.format(),
        end: end.format(),
        timezone: timezone
      },
      success: function(json) {
        return callback(json);
      }
    });
  };

  fullcalendar_select = function(start, end, jsEvent, view, resource, calendar) {
    view = calendar.fullCalendar('getView').name;
    if (view !== 'agendaDay') {
      calendar.fullCalendar('changeView', 'agendaDay');
      return calendar.fullCalendar('gotoDate', start);
    } else {
      calendar.fullCalendar({
        editable: false,
        selectable: false,
        resizable: false
      });
      $('#addEventForm input[name="chambre_id"]').val(resource.id);
      $('#addEventForm input[name="date"]').val(start.format('YYYY-MM-DD HH:mm:ss'));
      $('#eventModal').modal('show');
      calendar.fullCalendar({
        editable: true,
        selectable: true,
        resizable: true
      });
      return calendar.fullCalendar('unselect');
    }
  };

  fullcalendar_eventClick = function(calEvent, jsEvent, view, calendar) {
    var action;
    $('button.consulter a').attr('href', '/patient/' + calEvent.event.patient_id);
    $('button.afficher').attr('id_patient', calEvent.event.patient_id);
    action = $('#dossierInfoForm').attr('action');
    $('#dossierInfoModal #num_dossier').val(calEvent.event.patient.num_dossier);
    $('#dossierInfoModal #num_sante').val(calEvent.event.patient.num_sante);
    $('#dossierInfoModal #nom').val(calEvent.event.patient.nom);
    $('#dossierInfoModal #prenom').val(calEvent.event.patient.prenom);
    $('#dossierInfoModal #cin').val(calEvent.event.patient.cin);
    $('#dossierInfoModal #ville').val(calEvent.event.patient.ville);
    $('#dossierInfoModal #adresse').val(calEvent.event.patient.adresse);
    $('#dossierInfoModal #tel').val(calEvent.event.patient.tel);
    $('#dossierInfoModal #tel_urgence').val(calEvent.event.patient.tel_urgence);
    $('#dossierInfoModal #date_naissance').val(calEvent.event.patient.date_naissance);
    $('#dossierInfoModal #lieu_naissance').val(calEvent.event.patient.lieu_naissance);
    $('#dossierInfoModal #profession').val(calEvent.event.patient.profession);
    $('#dossierInfoModal #situationfamiliale_id').val(calEvent.event.patient.situationfamiliale_id).trigger('chosen:updated');
    $('#dossierInfoModal #groupesanguin_id').val(calEvent.event.patient.groupesanguin_id).trigger('chosen:updated');
    $('#dossierInfoModal #code_postal').val(calEvent.event.patient.code_postal);
    $('#dossierInfoModal #email').val(calEvent.event.patient.email);
    $('#dossierInfoModal #assurance').val(calEvent.event.patient.assurance);
    $('#dossierInfoModal #description').val(calEvent.event.patient.description);
    $('#dossierInfoForm').attr('action', action + '/' + calEvent.event.id);
    $('#dossierInfoModal #deleteRendezvous').attr('rendezvous_id', calEvent.event.id);
    $('#dossierInfoForm #user_id').val(calEvent.event.user_id).trigger('chosen:updated');
    $('#dossierInfoForm #pris_par').val($('#dossierInfoForm #user_id option[value="' + calEvent.event.pris_par + '"]').text());
    $('#dossierInfoForm #chambre_id').val(calendar.fullCalendar('getResourceById', calEvent.event.chambre_id).title);
    $('#dossierInfoForm #date').val(moment(calEvent.event.date).format('LLLL'));
    $('#dossierInfoForm #duree').val(calEvent.event.duree + ' min');
    $('#dossierInfoForm #description').val(calEvent.event.description);
    $('#dossierInfoForm #rdvstatus_id').val(calEvent.event.rdvstatus_id).trigger('chosen:updated');
    return $('#dossierInfoModal').modal('show');
  };

  fullcalendar_eventDrop = function(event, delta, revertFunc, calendar) {
    calendar.fullCalendar({
      editable: false,
      selectable: false,
      resizable: false
    });
    swal({
      title: 'Êtes-vous sûr ?',
      text: 'Êtes-vous sûr de faire ce changement?',
      confirmButtonText: 'Changer',
      confirmButtonColor: "#D4202B",
      customClass: 'medicament-alert',
      showCancelButton: true,
      closeOnConfirm: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false
    }).then(function(isConfirm) {
      if (isConfirm) {
        swal.enableLoading();
        return $.ajax({
          url: '/api/RdvChangeDate',
          type: 'post',
          data: {
            id: event.id,
            date: moment(event.start).format('YYYY-MM-DD HH:mm:ss'),
            chambre_id: event.resourceId
          },
          dataType: 'json',
          success: function(responseText, statusText, xhr) {
            if (xhr.responseJSON.result === 'success') {
              toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": true,
                "progressBar": true,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
              };
              toastr.success('Le rendez-vous a été deplacé avec succées', '');
              return swal.closeModal();
            } else {
              return console.log(xhr);
            }
          },
          error: function(xhr, status, error) {
            console.log('xhr : ');
            console.log(xhr);
            console.log('status : ');
            console.log(status);
            console.log('error :');
            return console.log(error);
          }
        });
      } else {
        return revertFunc();
      }
    });
    calendar.fullCalendar('unselect');
    return calendar.fullCalendar({
      editable: true,
      selectable: true,
      resizable: true
    });
  };

  fullcalendar_eventResize = function(event, delta, revertFunc, calendar) {
    calendar.fullCalendar({
      editable: false,
      selectable: false,
      resizable: false
    });
    swal({
      title: 'Êtes-vous sûr ?',
      text: 'Êtes-vous sûr de faire ce changement?',
      confirmButtonText: 'Changer',
      confirmButtonColor: "#D4202B",
      customClass: 'medicament-alert',
      showCancelButton: true,
      closeOnConfirm: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false
    }).then(function(isConfirm) {
      if (isConfirm) {
        swal.enableLoading();
        return $.ajax({
          url: '/api/RdvResizeDuree',
          type: 'post',
          data: {
            id: event.id,
            duree: event.end.diff(event.start, 'minutes', true)
          },
          dataType: 'json',
          success: function(responseText, statusText, xhr) {
            console.log(xhr);
            if (xhr.responseJSON.result === 'success') {
              toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": true,
                "progressBar": true,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
              };
              toastr.success('La duree a été modifié avec succées', '');
              return swal.closeModal();
            } else {
              return console.log(xhr);
            }
          },
          error: function(xhr, status, error) {
            console.log('xhr : ');
            console.log(xhr);
            console.log('status : ');
            console.log(status);
            console.log('error :');
            return console.log(error);
          }
        });
      } else {
        return revertFunc();
      }
    });
    return calendar.fullCalendar({
      editable: true,
      selectable: true,
      resizable: true
    });
  };

  resetAddEventFormErrors = function() {
    return $('#addEventForm .form-control').each(function() {
      var $this;
      $this = $(this);
      $this.closest('.input-group').removeClass('has-error has-feedback');
      $this.closest('.input-group').find('.form-control-feedback').remove();
      return $this.closest('.field').find('.help-block').remove();
    });
  };

  resetAddPatientFormErrors = function() {
    return $('#addPatientForm .form-control').each(function() {
      var $this;
      $this = $(this);
      $this.closest('.input-group').removeClass('has-error has-feedback');
      $this.closest('.input-group').find('.form-control-feedback').remove();
      return $this.closest('.field').find('.help-block').remove();
    });
  };

  resetAddDossierFormErrors = function() {
    var $this;
    $this = $(this);
    $this.closest('.input-group').removeClass('has-error has-feedback');
    $this.closest('.input-group').find('.form-control-feedback').remove();
    return $this.closest('.field').find('.help-block').remove();
  };

  $('input').iCheck({
    increaseArea: '-10%'
  });

  $(':radio').each(function(index, el) {
    var valeur;
    valeur = $(this).val();
    switch (valeur) {
      case 'male':
        return $(this).parent().removeClass('iradio_square-blue iradio_square-yellow iradio_square-green iradio_square-red iradio_square-orange').addClass('iradio_square-red hover');
      case 'female':
        return $(this).parent().removeClass('iradio_square-blue iradio_square-yellow iradio_square-green iradio_square-red iradio_square-orange').addClass('iradio_square-blue hover');
      default:
        return $(this).parent().removeClass('iradio_square-blue iradio_square-yellow iradio_square-green iradio_square-red iradio_square-orange').addClass('iradio_square-blue hover');
    }
  });

  $(".chosen-select").chosen({
    no_results_text: "Oops, aucun résultat n'a été trouvé!",
    width: "100%",
    search_contains: true
  });

  $.ajaxSetup({
    headers: {
      'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
  });

  calendar = $('#calendar').fullCalendar({
    schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
    lang: 'fr',
    handleWindowResize: true,
    eventLimit: true,
    allDaySlot: false,
    slotEventOverlap: false,
    slotDuration: '00:05:00',
    snapDuration: '00:05:00',
    nowIndicator: true,
    timeFormat: 'HH:mm',
    defaultView: 'month',
    height: "auto",
    contentHeight: "auto",
    buttonHtml: {
      prev: '<i class="fa fa-chevron-left"></i>',
      next: '<i class="fa fa-chevron-right"></i>'
    },
    header: {
      left: 'today prev,next',
      center: 'title',
      right: 'agendaDay,agendaWeek,month'
    },
    editable: true,
    selectable: true,
    eventOverlap: false,
    resizable: true,
    selectHelper: true,
    dragScroll: true,
    resources: 'api/resources',
    timezone: 'Africa/Casablanca',
    events: function(start, end, timezone, callback) {
      return fullcalendar_events(start, end, timezone, callback);
    },
    select: function(start, end, jsEvent, view, resource) {
      return fullcalendar_select(start, end, jsEvent, view, resource, calendar);
    },
    eventClick: function(calEvent, jsEvent, view) {
      return fullcalendar_eventClick(calEvent, jsEvent, view, calendar);
    },
    eventDrop: function(event, delta, revertFunc) {
      return fullcalendar_eventDrop(event, delta, revertFunc, calendar);
    },
    eventResize: function(event, delta, revertFunc) {
      return fullcalendar_eventResize(event, delta, revertFunc, calendar);
    }
  });

  $('#addEventFormReset').click(function() {
    return resetAddEventFormErrors();
  });

  $('#addEventForm').ajaxForm({
    clearForm: true,
    dataType: 'json',
    success: function(responseText, statusText, xhr) {
      toastr.options = {
        "closeButton": false,
        "debug": false,
        "newestOnTop": true,
        "progressBar": true,
        "positionClass": "toast-bottom-right",
        "preventDuplicates": false,
        "onclick": null,
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
      };
      toastr.success('Le rendez-vous a été ajouté avec succées', '');
      $('#calendar').fullCalendar('renderEvent', xhr.responseJSON.event, true);
      $('#eventModal').modal('hide');
      return $('#addEventForm select').val('').trigger('chosen:updated');
    },
    error: function(xhr, status, error) {
      if (status === 'error' && xhr.status === 422) {
        resetAddEventFormErrors();
        return $.each(xhr.responseJSON, function(index, value) {
          $('#addEventForm #' + index).closest('.input-group').addClass('has-error has-feedback');
          $('#addEventForm #' + index).closest('.input-group').append('<span class="glyphicon glyphicon-remove form-control-feedback"></span>');
          return $('#addEventForm #' + index).closest('.field').append('<span class="help-block" style="color:#A94442;">' + value + '</span>');
        });
      }
    }
  });

  $('#addPatientForm').ajaxForm({
    clearForm: true,
    dataType: 'json',
    success: function(responseText, statusText, xhr) {
      console.log(xhr);
      toastr.options = {
        "closeButton": false,
        "debug": false,
        "newestOnTop": true,
        "progressBar": true,
        "positionClass": "toast-bottom-right",
        "preventDuplicates": false,
        "onclick": null,
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
      };
      toastr.success('Le patient a été ajouté avec succées', '');
      $('#AjouterPatientModal').modal('hide');
      return $('#addEventForm select#patient_id').append('<option value="' + xhr.responseJSON.patient.id + '">' + xhr.responseJSON.patient.prenom + ' ' + xhr.responseJSON.patient.nom + '</option>').val(xhr.responseJSON.patient.id).trigger('chosen:updated');
    },
    error: function(xhr, status, error) {
      if (status === 'error' && xhr.status === 422) {
        resetAddPatientFormErrors();
        return $.each(xhr.responseJSON, function(index, value) {
          $('#addPatientForm #' + index).closest('.input-group').addClass('has-error has-feedback');
          $('#addPatientForm #' + index).closest('.input-group').append('<span class="glyphicon glyphicon-remove form-control-feedback"></span>');
          return $('#addPatientForm #' + index).closest('.field').append('<span class="help-block" style="color:#A94442;">' + value + '</span>');
        });
      }
    }
  });

  $('#dossierInfoForm').ajaxForm({
    dataType: 'json',
    success: function(responseText, statusText, xhr) {
      console.log(xhr);
      toastr.options = {
        "closeButton": false,
        "debug": false,
        "newestOnTop": true,
        "progressBar": true,
        "positionClass": "toast-bottom-right",
        "preventDuplicates": false,
        "onclick": null,
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
      };
      toastr.success('Les informations ont été modifié avec succées', '');
      return $('#dossierInfoModal').modal('hide');
    },
    error: function(xhr, status, error) {
      if (status === 'error' && xhr.status === 422) {
        resetAddDossierFormErrors();
        return $.each(xhr.responseJSON, function(index, value) {
          $('#dossierInfoForm #' + index).closest('.input-group').addClass('has-error has-feedback');
          $('#dossierInfoForm #' + index).closest('.input-group').append('<span class="glyphicon glyphicon-remove form-control-feedback"></span>');
          return $('#dossierInfoForm #' + index).closest('.field').append('<span class="help-block" style="color:#A94442;">' + value + '</span>');
        });
      }
    }
  });

  $('#dossierInfoModal #deleteRendezvous').on('click', function(event) {
    var rendezvous_id;
    event.preventDefault();
    rendezvous_id = $(this).attr('rendezvous_id');
    return swal({
      title: 'Êtes-vous sûr ?',
      text: 'Vous ne serez pas en mesure de récupérer ce rendez-vous!',
      confirmButtonText: 'Supprimer',
      confirmButtonColor: "#D4202B",
      customClass: 'medicament-alert',
      showCancelButton: true,
      closeOnConfirm: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false
    }).then(function(isConfirm) {
      if (isConfirm) {
        swal.enableLoading();
        return $.ajax({
          url: '/api/Rdvdelete',
          type: 'post',
          data: {
            id: rendezvous_id
          },
          dataType: 'json',
          success: function(responseText, statusText, xhr) {
            if (xhr.responseJSON.result === 'success') {
              $('#calendar').fullCalendar('removeEvents', function(ev) {
                return ev._id === rendezvous_id;
              });
              $('#dossierInfoModal').modal('hide');
              toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": true,
                "progressBar": true,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
              };
              toastr.success('Le rendez-vous a été supprimé avec succées', '');
              return swal.closeModal();
            } else {
              return console.log(xhr);
            }
          },
          error: function(xhr, status, error) {
            console.log('xhr : ');
            console.log(xhr);
            console.log('status : ');
            console.log(status);
            console.log('error :');
            return console.log(error);
          }
        });
      }
    });
  });

  chosen_ajaxify('patient_id', '/api/patientChosen?name=');

  chosen_ajaxify('user_id', '/api/userChosen?role=medecin&name=');

  $('#dossierInfoModal #afficher_profile').on('click', function(event) {
    var patient_id, that;
    event.preventDefault();
    that = $(this);
    patient_id = that.attr('id_patient');
    return $.ajax({
      url: '/api/showToDoc',
      type: 'post',
      data: {
        patient_id: patient_id,
        user_id: $('#dossierInfoForm #user_id').val()
      },
      dataType: 'json',
      success: function(responseText, statusText, xhr) {
        console.log(xhr);
        if (xhr.responseJSON.result === 'success') {
          toastr.options = {
            "closeButton": false,
            "debug": false,
            "newestOnTop": true,
            "progressBar": true,
            "positionClass": "toast-bottom-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
          };
          return toastr.success('Le rendez-vous a été supprimé avec succées', '');
        } else {
          return console.log(xhr);
        }
      },
      error: function(xhr, status, error) {
        console.log('xhr : ');
        console.log(xhr);
        console.log('status : ');
        console.log(status);
        console.log('error :');
        return console.log(error);
      }
    });
  });

}).call(this);

//# sourceMappingURL=agenda.min.js.map
